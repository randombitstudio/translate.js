(function(a){function l(){var a=this;this.$element.dblclick(function(){a.toggle()});return this}function m(){var c=this,d=a("#"+this.options.buttonId);if(1===d.length)this.$element.after(d.clone().attr("id",null).on("click",function(){c.toggle()}));else throw Error("A single instance of the translate button could not be located.");return this}function k(a,d,b,f){var e=b.clone().removeClass(this.options.templateClass);e.find("."+this.options.languageClass).text(a);e.find("."+this.options.translationClass).val(d);
e.find("."+this.options.languageRemoveClass).on("click",function(){e.remove()});f.append(e);return this}function g(c,d){var b=a("<input/>").attr("type","hidden").attr("name",this.$element.attr("name")+"["+c+"]").data("language",c).val(d);this.$element.append(b);return this}var n=["INPUT"],p=["array","json"],h=function(c,d){var b=this;this.$element=a(c);this.$dataContainer=null;this.isOpen=!1;this.options=a.extend({},a.fn.translate.defaults,d);if(-1===a.inArray(this.options.submits,p))throw Error("Trying to use an unrecognized submit type ["+
this.options.submits+"] in the transaltion plugin.");this.$element.on("keyup",function(){var d=b.$element.data("language"),e=b.$element.val(),c={};"json"===b.options.submits?(c=a.extend({},a.parseJSON(b.$dataContainer.val())),c[d]=e,b.$dataContainer.val(JSON.stringify(c))):"array"===b.options.submits&&(a.each(a('input[name^="'+b.$element.attr("name")+'["]'),function(b,d){c[a(d).data("language")]=a(d).val()}),c[d]=e,a.each(c,function(a,c){g.call(b,a,c)}))});"json"===this.options.submits?(this.$dataContainer=
a("<input/>").attr("type","hidden").attr("name",this.$element.attr("name")).val(JSON.stringify(this.$element.data("translations"))),this.$element.append(this.$dataContainer)):"array"===this.options.submits&&a.each(this.$element.data("translations"),function(a,c){g.call(b,a,c)});this.$element.popover({container:"body",html:!0,placement:"bottom",title:"",trigger:"manual",template:'<div class="popover" style="max-width: 420px;"><div class="arrow"></div><div class="popover-inner"><div class="popover-content"><p></p></div></div></div>',
content:function(){return b.decode()}});a.each(this.options.toggles,function(a,c){"doubleClick"===c?l.call(b):"buttonClick"===c&&m.call(b)})};h.prototype={toggle:function(){this.isOpen?(this.encode(),this.$element.popover("hide"),this.isOpen=!1):(this.$element.popover("show"),this.isOpen=!0)},decode:function(){var c=this,d={},b=a("#"+this.options.popupId).clone().attr("id",null).addClass(this.options.openPopupClass),f=b.find("."+this.options.translationRowClass);null!==this.options.autocomplete&&
b.find("."+this.options.languageSelectClass).typeahead(this.options.autocomplete);b.find("."+this.options.languageAddClass).on("click",function(){var d=b.find("."+c.options.languageSelectClass).val();0===b.find("."+c.options.languageClass).filter(function(){return a(this).text()===d&&0===a(this).parents("."+c.options.templateClass).length}).length&&k.call(c,d,"",f,b)});"json"===this.options.submits?d=a.parseJSON(this.$dataContainer.val()):"array"===this.options.submits&&a.each(a('input[name^="'+this.$element.attr("name")+
'["]'),function(b,c){d[a(c).data("language")]=a(c).val()});a.each(d,function(a,d){k.call(c,a,d,f,b)});return b},encode:function(){var c=this,d=a("."+this.options.openPopupClass),b={};a.each(d.find("."+this.options.translationRowClass+":not(."+this.options.templateClass+")"),function(d,e){b[a(e).find("."+c.options.languageClass).text()]=a(e).find("."+c.options.translationClass).val()});"json"===this.options.submits?this.$dataContainer.val(JSON.stringify(b)):"array"===this.options.submits&&(a('input[name^="'+
this.$element.attr("name")+'["]').remove(),a.each(b,function(a,b){g.call(c,a,b)}));this.$element.val("");"undefined"!==typeof b[this.$element.data("language")]&&this.$element.val(b[this.$element.data("language")]);return this}};a.fn.translate=function(c){return this.each(function(){var d=a(this),b=d.data("translate"),f=a.extend({},a.fn.translate.defaults,d.data(),"object"===typeof c&&c);if(-1===a.inArray(d.prop("tagName"),n)||"text"!==d.attr("type"))throw Error("Translation of "+d.prop("tagName")+
" elements is currently not supported.");b&&"object"===typeof b||(b=new h(this,f),d.data("translate",b));"string"===typeof c&&b[c].call(d)})};a.fn.translate.defaults={autocomplete:{},toggles:["doubleClick","buttonClick"],submits:"json",buttonId:"translate-button",popupId:"translate-container",openPopupClass:"translate-current",languageSelectClass:"language-select",languageAddClass:"language-add",languageRemoveClass:"language-remove",translationRowClass:"translation-row",languageClass:"language-name",
translationClass:"language-value",templateClass:"translation-template"};a.fn.translate.Constructor=h})(window.jQuery);
